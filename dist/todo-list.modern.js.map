{"version":3,"file":"todo-list.modern.js","sources":["../src/index.ts"],"sourcesContent":["interface ITodoList extends HTMLElement {\n    _input: HTMLInputElement;\n    _submit: HTMLButtonElement;\n    _list: ITodoListElement;\n    _todos: WeakMap<ITodoItem, string>;\n    _useLocal: boolean;\n    get _lastItem(): ITodoItem;\n    set _todosLocal(todo: string|string[]);\n    get _todosLocal():string[];\n    add(todo: string, shouldStore: boolean): void;\n    delete(todo: ITodoItem): void;\n    handleEvent(e: MouseEvent): void;\n    connectedCallback():void;\n    disconnectedCallback():void;\n}\n\ninterface ITodoListElement extends HTMLUListElement {\n    children: HTMLCollectionOf<ITodoItem>;\n}\n\ninterface ITodoItem extends HTMLElement {\n    _listParent: ITodoList;\n    _removeSelf():void;\n    handleEvent(e: MouseEvent):void;\n    connectedCallback(): void;\n    disconnectedCallback(): void;\n}\n\nwindow.customElements.define('todo-list', class extends HTMLElement implements ITodoList {\n    _todos = new WeakMap();\n    _input = this.querySelector<HTMLInputElement>('[ref=\"input\"]')!;\n    _submit = this.querySelector<HTMLButtonElement>('[ref=\"submit\"]')!;\n    _list = this.querySelector<ITodoListElement>('[ref=\"list\"]')!;\n    _useLocal = this.hasAttribute('use-local');\n    constructor() {\n        super();\n    }\n\n    get _lastItem() {\n        return this._list.children[this._list.children.length - 1];\n    }\n\n    set _todosLocal(todo: string|string[]) {\n        if (typeof todo === 'string') {\n            const data = JSON.parse(localStorage.getItem('todos') || '[]');\n            data.push(todo);\n            localStorage.setItem('todos', JSON.stringify(data));\n        } else if (Array.isArray(todo)) {\n            localStorage.setItem('todos', JSON.stringify(todo));\n        }\n    }\n\n    get _todosLocal(): string[] {\n        return JSON.parse(localStorage.getItem('todos') || '[]');\n    }\n\n    add(todo: string, shouldStore = this._useLocal) {\n        const li = document.createElement('li', { is: 'todo-item' });\n        li.setAttribute('title', todo);\n        this._list.insertAdjacentElement('beforeend', li)\n\n        this._todos.set(this._lastItem, todo);\n        this._input.value = '';\n        if (shouldStore) {\n            this._todosLocal = todo;\n        }\n    }\n\n    delete(todoElement: ITodoItem) {\n        if (this._todos.has(todoElement)) {\n            this._todos.delete(todoElement);\n            todoElement.remove();\n            if (this._useLocal) {\n                const data = this._todosLocal;\n                const indexOfTodo = data.indexOf(todoElement.getAttribute('title')!);\n                data.splice(indexOfTodo, 1);\n                this._todosLocal = data;\n            }\n        }\n    }\n\n    handleEvent({ type, target }) {\n        if (\n            type === 'click' &&\n            target.closest('[ref=\"submit\"]') &&\n            this._input.value !== ''\n        ) {\n            this.add(this._input.value);\n        }\n    }\n\n    connectedCallback() {\n        this._useLocal &&\n            this._todosLocal\n                .forEach(todo => this.add(todo, false));\n\n        this._submit.addEventListener('click', this);\n    }\n\n    disconnectedCallback() {\n        this._submit.removeEventListener('click', this);\n    }\n})\n\nwindow.customElements.define('todo-item', class extends HTMLElement implements ITodoItem {\n    _listParent: ITodoList = this.closest('todo-list')!;\n    constructor() {\n        super();\n        if (!this.hasAttribute('title')) {\n            throw new Error('TodoItem must have a title attribute to be constructed');\n        }\n        // Customized built-in elements don't have enough support. Using the role attribute ponyfills it.\n        this.setAttribute('role', 'listitem');\n    }\n\n    static observedAttributes() {\n        return ['title'];\n    }\n\n    attributeChangedCallback(name: string, _oldValue: unknown, newValue: string) {\n        if (name !== 'title') return;\n\n        this.innerHTML = `<span>${newValue}</span><button type=\"button\">&times; Clear</button>`\n    }\n\n    _removeSelf() {\n        this._listParent.delete(this);\n    }\n\n    handleEvent({ type, target }) {\n        if (type !== 'click') return;\n        if (!(target as HTMLElement).closest('[type=\"button\"]')) return;\n\n        this._removeSelf();\n    }\n\n    connectedCallback() {\n        this.addEventListener('click', this as unknown as EventListenerObject);\n    }\n\n    disconnectedCallback() {\n        this.removeEventListener('click', this as unknown as EventListenerObject);\n    }\n})"],"names":["window","customElements","define","HTMLElement","constructor","super","this","_todos","WeakMap","_input","querySelector","_submit","_list","_useLocal","hasAttribute","_lastItem","children","length","_todosLocal","todo","data","JSON","parse","localStorage","getItem","push","setItem","stringify","Array","isArray","add","shouldStore","li","document","createElement","is","setAttribute","insertAdjacentElement","set","value","delete","todoElement","has","remove","indexOfTodo","indexOf","getAttribute","splice","handleEvent","type","target","closest","connectedCallback","forEach","addEventListener","disconnectedCallback","removeEventListener","_listParent","Error","observedAttributes","attributeChangedCallback","name","_oldValue","newValue","innerHTML","_removeSelf"],"mappings":"AA4BAA,OAAOC,eAAeC,OAAO,YAAa,cAAcC,YAMpDC,WAAAA,GACIC,QAAQC,KANZC,EAAS,IAAIC,QAASF,KACtBG,EAASH,KAAKI,cAAgC,iBAC9CC,KAAAA,EAAUL,KAAKI,cAAiC,kBAChDE,KAAAA,EAAQN,KAAKI,cAAgC,qBAC7CG,EAAYP,KAAKQ,aAAa,YAG9B,CAEA,KAAIC,GACA,OAAWT,KAACM,EAAMI,SAASV,KAAKM,EAAMI,SAASC,OAAS,EAC5D,CAEA,KAAIC,CAAYC,GACZ,GAAoB,iBAATA,EAAmB,CAC1B,MAAMC,EAAOC,KAAKC,MAAMC,aAAaC,QAAQ,UAAY,MACzDJ,EAAKK,KAAKN,GACVI,aAAaG,QAAQ,QAASL,KAAKM,UAAUP,GAChD,MAAUQ,MAAMC,QAAQV,IACrBI,aAAaG,QAAQ,QAASL,KAAKM,UAAUR,GAErD,CAEA,KAAID,GACA,OAAOG,KAAKC,MAAMC,aAAaC,QAAQ,UAAY,KACvD,CAEAM,GAAAA,CAAIX,EAAcY,EAAczB,KAAKO,GACjC,MAAMmB,EAAKC,SAASC,cAAc,KAAM,CAAEC,GAAI,cAC9CH,EAAGI,aAAa,QAASjB,GACzBb,KAAKM,EAAMyB,sBAAsB,YAAaL,GAE9C1B,KAAKC,EAAO+B,IAAIhC,KAAKS,EAAWI,GAChCb,KAAKG,EAAO8B,MAAQ,GAChBR,IACAzB,KAAKY,EAAcC,EAE3B,CAEAqB,OAAOC,GACH,GAAInC,KAAKC,EAAOmC,IAAID,KAChBnC,KAAKC,EAAOiC,OAAOC,GACnBA,EAAYE,SACRrC,KAAKO,GAAW,CAChB,MAAMO,EAAOd,KAAKY,EACZ0B,EAAcxB,EAAKyB,QAAQJ,EAAYK,aAAa,UAC1D1B,EAAK2B,OAAOH,EAAa,GACzBtC,KAAKY,EAAcE,CACtB,CAET,CAEA4B,WAAAA,EAAYC,KAAEA,EAAIC,OAAEA,IAEH,UAATD,GACAC,EAAOC,QAAQ,mBACO,KAAtB7C,KAAKG,EAAO8B,OAEZjC,KAAKwB,IAAIxB,KAAKG,EAAO8B,MAE7B,CAEAa,iBAAAA,GACI9C,KAAKO,GACDP,KAAKY,EACAmC,QAAQlC,GAAQb,KAAKwB,IAAIX,GAAM,IAExCb,KAAKK,EAAQ2C,iBAAiB,QAAShD,KAC3C,CAEAiD,oBAAAA,GACIjD,KAAKK,EAAQ6C,oBAAoB,QAASlD,KAC9C,IAGJN,OAAOC,eAAeC,OAAO,YAAa,cAAcC,YAEpDC,WAAAA,GAEI,GADAC,QAAQC,KAFZmD,EAAyBnD,KAAK6C,QAAQ,cAG7B7C,KAAKQ,aAAa,SACnB,MAAM,IAAI4C,MAAM,0DAGpBpD,KAAK8B,aAAa,OAAQ,WAC9B,CAEA,yBAAOuB,GACH,MAAO,CAAC,QACZ,CAEAC,wBAAAA,CAAyBC,EAAcC,EAAoBC,GAC1C,UAATF,IAEJvD,KAAK0D,UAAY,SAASD,uDAC9B,CAEAE,CAAAA,GACI3D,KAAKmD,EAAYjB,OAAOlC,KAC5B,CAEA0C,WAAAA,EAAYC,KAAEA,EAAIC,OAAEA,IACH,UAATD,GACEC,EAAuBC,QAAQ,oBAErC7C,KAAK2D,GACT,CAEAb,iBAAAA,GACI9C,KAAKgD,iBAAiB,QAAShD,KACnC,CAEAiD,oBAAAA,GACIjD,KAAKkD,oBAAoB,QAASlD,KACtC"}